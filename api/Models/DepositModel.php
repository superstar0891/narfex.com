<?php

namespace Models;

use Db\Model\Field\CharField;
use Db\Model\Field\DateField;
use Db\Model\Field\DateTimeField;
use Db\Model\Field\DoubleField;
use Db\Model\Field\FloatField;
use Db\Model\Field\IdField;
use Db\Model\Field\IntField;
use Db\Model\Model;

/**
 * @property int id
 * @property int user_id
 * @property int wallet_id
 * @property int plan
 * @property int dynamic_percent
 * @property float dynamic_coeff
 * @property int days
 * @property string status
 * @property string operation
 * @property string currency
 * @property double amount
 * @property string created_at
 * @property string date_start
 * @property int withdraw_disabled
 * @property float withdraw_disabled_coeff
 * @property double dynamic_curr_percent
 * @property float plan_percent_coeff
 * @property double dynamic_profit
 * @property double dynamic_profit_share
 * @property double dynamic_daily_percent
 * @property double dynamic_start_percent
 * @property double charged_amount
 */
class DepositModel extends Model {

    const TYPE_LEGACY = 0;
    const TYPE_STATIC = 1;
    const TYPE_DYNAMIC = 2;
    const TYPE_POOL = 3;

    const STATUS_DONE = 'done';
    const STATUS_ACCEPTED = 'accepted';

    const PROFIT_TYPE_REINVEST_PROFIT = 'reinvest_profit';
    const PROFIT_TYPE_INVEST_PROFIT = 'invest_profit';
    const PROFIT_TYPE_RETURN_DEPOSIT = 'return_deposit';
    const PROFIT_TYPE_POOL_PROFIT = 'pool_profit';
    const PROFIT_TYPE_REFERRAL_PROFIT = 'referral_profit';

    const REFERRAL_PROFIT = 0.03;

    protected static $table_name = 'deposits';

    const USERS_WITH_ENABLED_DEPOSITS = [
        24,
        26,
        108,
        448,
        449,
        567,
        583,
        793,
        819,
        899,
        901,
        906,
        1023,
        1044,
        1055,
        1064,
        1084,
        1097,
        1129,
        1154,
        1181,
        1194,
        1207,
        1225,
        1227,
        1229,
        1233,
        1239,
        1273,
        1274,
        1281,
        1300,
        1321,
        1326,
        1339,
        1341,
        1387,
        1389,
        1399,
        1400,
        1428,
        1432,
        1465,
        1486,
        1491,
        1504,
        1517,
        1521,
        1538,
        1544,
        1547,
        1551,
        1559,
        1581,
        1583,
        1585,
        1586,
        1593,
        1598,
        1605,
        1606,
        1609,
        1628,
        1634,
        1668,
        1679,
        1686,
        1706,
        1724,
        1725,
        1726,
        1740,
        1741,
        1745,
        1748,
        1759,
        1789,
        1806,
        1819,
        1820,
        1821,
        1826,
        1831,
        1838,
        1839,
        1842,
        1845,
        1854,
        1859,
        1862,
        1870,
        1891,
        1894,
        1904,
        1905,
        1908,
        1909,
        1916,
        1918,
        1927,
        1929,
        1930,
        1931,
        1933,
        1939,
        1940,
        1941,
        1942,
        1947,
        1948,
        1949,
        1961,
        1962,
        1972,
        1979,
        1982,
        1983,
        1985,
        1986,
        1991,
        1992,
        1993,
        1994,
        1995,
        1997,
        2001,
        2015,
        2017,
        2018,
        2024,
        2025,
        2028,
        2030,
        2032,
        2033,
        2034,
        2035,
        2036,
        2040,
        2041,
        2042,
        2043,
        2047,
        2048,
        2051,
        2054,
        2065,
        2067,
        2068,
        2077,
        2083,
        2088,
        2146,
        2149,
        2150,
        2152,
        2153,
        2155,
        2162,
        2164,
        2173,
        2178,
        2180,
        2182,
        2187,
        2188,
        2189,
        2194,
        2202,
        2204,
        2207,
        2208,
        2209,
        2211,
        2212,
        2213,
        2215,
        2216,
        2218,
        2219,
        2221,
        2223,
        2224,
        2228,
        2229,
        2232,
        2239,
        2242,
        2243,
        2244,
        2245,
        2246,
        2259,
        2265,
        2268,
        2273,
        2277,
        2298,
        2299,
        2306,
        2311,
        2313,
        2314,
        2320,
        2336,
        2351,
        2360,
        2361,
        2362,
        2364,
        2371,
        2373,
        2379,
        2393,
        2394,
        2397,
        2402,
        2403,
        2419,
        2422,
        2431,
        2432,
        2439,
        2443,
        2445,
        2458,
        2468,
        2473,
        2474,
        2477,
        2478,
        2483,
        2486,
        2508,
        2512,
        2514,
        2518,
        2521,
        2523,
        2525,
        2528,
        2529,
        2530,
        2535,
        2536,
        2539,
        2549,
        2566,
        2569,
        2572,
        2593,
        2596,
        2597,
        2600,
        2613,
        2614,
        2616,
        2637,
        2656,
        2674,
        2733,
        2753,
        2754,
        2767,
        2778,
        2782,
        2785,
        2787,
        2793,
        2794,
        2803,
        2808,
        2811,
        2815,
        2816,
        2819,
        2835,
        2842,
        2845,
        2861,
        2863,
        2864,
        2870,
        2871,
        2872,
        2879,
        2883,
        2887,
        2896,
        2907,
        2913,
        2924,
        2937,
        2942,
        2946,
        2976,
        2977,
        2996,
        3027,
        3029,
        3059,
        3072,
        3079,
        3095,
        3097,
        3101,
        3113,
        3128,
        3131,
        3133,
        3188,
        3196,
        3200,
        3208,
        3213,
        3216,
        3220,
        3221,
        3222,
        3223,
        3224,
        3225,
        3226,
        3227,
        3228,
        3229,
        3230,
        3231,
        3232,
        3233,
        3234,
        3235,
        3236,
        3237,
        3238,
        3239,
        3240,
        3241,
        3242,
        3243,
        3244,
        3245,
        3246,
        3247,
        3248,
        3249,
        3250,
        3251,
        3252,
        3253,
        3254,
        3255,
        3256,
        3257,
        3258,
        3259,
        3260,
        3261,
        3262,
        3263,
        3264,
        3265,
        3266,
        3267,
        3268,
        3269,
        3270,
        3271,
        3272,
        3274,
        3282,
        3283,
        3284,
        3285,
        3286,
        3287,
        3288,
        3289,
        3290,
        3293,
        3294,
        3295,
        3296,
        3297,
        3298,
        3299,
        3300,
        3301,
        3302,
        3303,
        3304,
        3305,
        3307,
        3308,
        3309,
        3310,
        3311,
        3312,
        3313,
        3314,
        3315,
        3316,
        3317,
        3318,
        3319,
        3320,
        3321,
        3329,
        3330,
        3331,
        3332,
        3333,
        3334,
        3335,
        3336,
        3337,
        3338,
        3339,
        3340,
        3342,
        3345,
        3346,
        3347,
        3348,
        3349,
        3351,
        3353,
        3354,
        3359,
        3362,
        3364,
        3367,
        3376,
        3379,
        3380,
        3381,
        3382,
        3383,
        3384,
        3385,
        3386,
        3387,
        3388,
        3389,
        3390,
        3391,
        3392,
        3393,
        3394,
        3395,
        3396,
        3397,
        3398,
        3399,
        3400,
        3401,
        3402,
        3403,
        3404,
        3405,
        3406,
        3407,
        3408,
        3409,
        3410,
        3411,
        3412,
        3413,
        3414,
        3415,
        3416,
        3417,
        3418,
        3419,
        3420,
        3421,
        3422,
        3423,
        3424,
        3425,
        3426,
        3427,
        3428,
        3429,
        3430,
        3431,
        3432,
        3433,
        3434,
        3435,
        3436,
        3437,
        3438,
        3439,
        3440,
        3441,
        3442,
        3443,
        3444,
        3445,
        3446,
        3447,
        3448,
        3449,
        3450,
        3451,
        3452,
        3453,
        3454,
        3465,
        3468,
        3469,
        3470,
        3471,
        3472,
        3473,
        3474,
        3475,
        3481,
        3493,
        3497,
        3501
    ];

    protected static $fields = [];

    protected static function fields(): array {
        return [
            'user_id' => IdField::init(),
            'wallet_id' => IdField::init(),
            'plan' => IntField::init(),
            'dynamic_percent' => IntField::init(),
            'days' => IntField::init()->setDefault(0),
            'status' => CharField::init()->setLength(32),
            'operation' => CharField::init()->setLength(32),
            'currency' => DoubleField::init(),
            'amount' => DoubleField::init(),
            'dynamic_profit' => DoubleField::init()->setDefault(0),
            'dynamic_coeff' => FloatField::init()->setDefault(1),
            'created_at' => DateTimeField::init(),
            'date_start' => DateField::init(),
            'withdraw_disabled' => IntField::init(),
            'withdraw_disabled_coeff' => FloatField::init(),
            'dynamic_curr_percent' => DoubleField::init(),
            'plan_percent_coeff' => FloatField::init(),
            'dynamic_profit_share' => DoubleField::init()->setDefault(0),
            'dynamic_daily_percent' => DoubleField::init()->setDefault(0),
            'dynamic_start_percent' => DoubleField::init()->setDefault(0),
            'charged_amount' => DoubleField::init()->setDefault(0),
        ];
    }

    public function getWholeProfit(): float {
        /* @var \Models\PlanModel $plan */
        $plan = PlanModel::get($this->plan, false);
        if ($this->dynamic_percent) {
            return  ($this->dynamic_profit +
                ($this->amount *
                    $this->dynamic_coeff *
                    ($plan->days - $this->days) * $plan->percent / 100
                )
            );
        } else {
            return $this->amount * $plan->days * $plan->percent / 100;
        }
    }

    public function isStatic(): bool {
        return $this->dynamic_percent == self::TYPE_STATIC;
    }

    public function isLegacy(): bool {
        return $this->dynamic_percent == self::TYPE_LEGACY;
    }

    public function isDynamic(): bool {
        return $this->dynamic_percent == self::TYPE_DYNAMIC;
    }
}
